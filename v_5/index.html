<!doctype html>
<html>
<head>
    
    <title>FusionCharts Dev Samples</title>
    <link href="main.css" type="text/css" rel="stylesheet">
    
    <script type="text/javascript" src="sort.js"></script>
    <script type="text/javascript" src="nedb.js"></script>
    <script type="text/javascript" src="lib.js"></script>
    <script type="text/javascript" src="data.js"></script>
    
    <script type="text/javascript">

    window.benchmarkTableElements = [{
        name: "OperationName",
        manipulate: function() {
            return (arguments[0])?arguments[0].opName:"";
        }
    }, {
        name: "Start time",
        manipulate: function() {
            var date = new Date(arguments[0].startTime);
            return (arguments[0])?date.toDateString() + " "+ date.toTimeString():"";
        }
    }, {
        name: "End time",
        manipulate: function() {
            var date = new Date(arguments[0].finishTime);
            return (arguments[0])?date.toDateString() + " "+ date.toTimeString():"";
        }
    }, {
        name: "Duration (ms)",
        manipulate: function() {
            return (arguments[0])?arguments[0].duration:"";
        }
    }, {
        name: "Remarks",
        manipulate: function() {
            return (arguments[0].remarks)?arguments[0].remarks:"Nothing";
        }
    }];//"Operation name", "Start time", "End time", "Duration", "Remarks"
    
    // function addDataButtons() {
    //     var container = document.getElementById("table_add"),
    //         i;
    //     for (i in dataStore) {
    //         container.innerHTML += "&nbsp;&nbsp;<option value='"+i+"' class='add_table__data_botton_class'>Add to Table \"" + i + "\"</option>";
    //         // creating the databses
    //         mainDatabase[i] = new Nedb();
    //     }
    // }

    var convertNumberToWord = (function(number) {
        if(number<100) {
            return number;
        }
        var word = "";
        var tempData = number.toString();

        if(tempData.length<9) {
            var zero = "";
            for(var index=0;index<(9-tempData.length); index++) {
                zero += "0";
            }
            tempData = zero+tempData;
        }
        word = (((tempData[tempData.length-7]!="0")?tempData[tempData.length-7]:"")+((tempData[tempData.length-6]!="0")?tempData[tempData.length-6]:((tempData[tempData.length-7]!=0)?tempData[tempData.length-6]:""))+((tempData[tempData.length-7]!=0||tempData[tempData.length-6]!=0)?" Lakh ":""))+ ((tempData[tempData.length-5]!="0"?tempData[tempData.length-5]:"")+(tempData[tempData.length-4]!="0"?tempData[tempData.length-4]:(tempData[tempData.length-5]!="0"?tempData[tempData.length-4]:""))+((tempData[tempData.length-5]!="0"||tempData[tempData.length-4]!="0")?" Thousand ":"")) + ((tempData[tempData.length-3]!="0")?(tempData[tempData.length-3] + " Hundred "):"") +  ((tempData[tempData.length-2]!="0"?tempData[tempData.length-2]:"")+((tempData[tempData.length-1]!="0")?tempData[tempData.length-1]:((tempData[tempData.length-2]!="0")?tempData[tempData.length-1]:"")));
        var flag = 0;
        for(var index=0;index<=tempData.length-8;index++) {
            if(tempData[index]!="0") {
                word = tempData.slice(index, tempData.length-7)+" Crore " + word;
                break;
            }
        }
        return word+"  ("+number+") ";
    });
    // function addTableData() {
    //     var sel = document.getElementById("table_add");
    //     if(sel.value!=globalTableName) {
    //         alert("Data file not found");
    //         return false;
    //     } else {
    //         mainDatabase[sel.value].find({}, function(error, recordSet){
    //             if(recordSet.length>=globalDataLimit) {
    //                 alert("Data file doesn't contain more data");
    //                 return false;
    //             } else {
    //                 var name = sel.value
    //                 var startIndex = 0;
    //                 if(!recordSet.length) {
    //                     startIndex = 0;
    //                 } else {
    //                     startIndex = recordSet.length-1;
    //                 }alert(startIndex);
    //                 mainDatabase[name].insert(dataStore[name].data.slice(startIndex, (startIndex+parseInt(document.getElementById("numrow").value))));                    
    //             }
    //         });    
    //     }
        
    // }

    </script>
    <script type="text/javascript">
        var url = window.location.href;
        var globalTableName = "order";
        var globalDataLimit = 1000,
        numberOfDataArray = [1000, 2000, 4000, 7000, 10000, 20000, 40000, 70000,100000, 200000, 400000, 700000, 1000000, 7000000, 10000000, 20000000, 40000000, 70000000, 100000000],
        i,
        l = numberOfDataArray.length;
        if(url.indexOf('table')!=-1 || url.indexOf('data-limit')!=-1) {
            var queryStringArray = url.split("?").pop().split("&");
            
            for(var index in queryStringArray) {
                if(queryStringArray[index].indexOf("table")!=-1) {
                    globalTableName = queryStringArray[index].split("=").pop();
                }
                if(queryStringArray[index].indexOf("data-limit")!=-1) {
                    globalDataLimit = parseInt(queryStringArray[index].split("=").pop());   
                }
            }
            if(globalDataLimit>0) {
                for (i = 1; i < l && numberOfDataArray[i] < globalDataLimit; i ++) {

                }
            } else {
                globalDataLimit = 1000
            }
            var fileName = globalTableName+"_data_"+globalDataLimit+".js";
            var script = document.createElement("script");
            script.setAttribute('type', 'text/javascript');
            script.setAttribute('src', 'data/json/'+fileName);
            document.head.appendChild(script);
            
        }
    </script>
</head>

<body>
    <div></div>
    
    <div>
       
    </div>
    <div id="div_tab">
        <div id="div_listOfTable"></div>
        <div id="div_info" class="wrapper"></div>
    </div>

    <div class="wrapper">

        <!-- <div class="block">
            <label for="numrow">Number of rows</label>
            <input type="text" id="numrow" value="10000">
        </div>
        <div id="" class="block">
            <select id="table_add"></select>
            <button class="btn" id="btn_addData" onclick="addTableData()">Go</button>
        </div> -->
        
        <div id="table_operations">
            <div class="label">Select the operation first</div>
            <div id="div_operationList"></div>
            <div id="div_operation"></div>
            <div id="div_operation_comment"></div>
            
        </div>

        <div>
            <div class="label">Benchmark results</div><br/>
            <table class="table-bordered" id="tbl_benchmark">
                
            </table>
        </div>

    </div><!-- wrapper  End-->

    <script type="text/javascript">
    //addDataButtons();
    </script>
    <script type="text/javascript" src="ui.js"></script>
    <script type="text/javascript" src="operations.js"></script>
    <script type="text/javascript">
    var displayContent = (function(tabIndex) {
        var tabElements = document.getElementsByClassName('tab');
        for(var index=0;index<tabElements.length; index++) {
            if(typeof tabElements[index].className!="undefined" && tabElements[index].className.indexOf('active')!=-1) {
                tabElements[index].className = "tab";
            }
            if(tabElements[index].innerHTML == tabIndex) {
                tabElements[index].className = "tab active";   
            }
        }
        var displayInfo = "";
        displayInfo += "<table class='table table-bordered'><tr><th>Number of Data</th><th>Fields(type)</th></tr>";
        displayInfo += "<tr><td id='dataLength_"+tabIndex+"'>"+ convertNumberToWord(dataStore[tabIndex].data.length) + "</td><td>";
        for(var index2 in dataStore[tabIndex].fields) {
            displayInfo += (parseInt(index2)+1)+">"+dataStore[tabIndex].fields[index2].name+"("+((dataStore[tabIndex].data[0])?typeof dataStore[tabIndex].data[0][dataStore[tabIndex].fields[index2].name]:"undefined type")+"), ";
        }
        displayInfo = displayInfo.substring(0, displayInfo.length - 1);
        displayInfo += "</td></tr></table>";
        document.getElementById("div_info").innerHTML = displayInfo;    
    });
    (function() {
        // populate the tab based on number of tabs
        var tabHTML = "";
        for(var tableIndex in dataStore) {
            tabHTML += "<div onclick='displayContent(\""+tableIndex+"\")' class='tab'>"+tableIndex+"</div>";
        }
        document.getElementById("div_listOfTable").innerHTML = tabHTML;
        document.getElementsByClassName('tab')[0].click();
    })();
    
    var performOperation = (function(operationName) {
        if(operationName=="sort") {
            initializeSort();
        } else if(operationName == "search") {
            initializeSearch();
        }
    });
    
    (function() {
        var html = ""
        for(var index in operationArray) {
            html+="<span><button class='btn' onclick='operationArray[\"" + index + "\"].click()'>"+index+"</button><div class='div_operation' id='div_operation_"+index+"'></div></span>";
        }
        document.getElementById("div_operationList").innerHTML = html;
    })();

    // this function creates the benchmark table
    (function() {
        var trHTML = "<tr>";
        for(var elementIndex in window.benchmarkTableElements) {
            trHTML+= "<th>" + benchmarkTableElements[elementIndex].name + "</th>";
        }
        trHTML += "</tr>";
        document.getElementById("tbl_benchmark").innerHTML = trHTML;
    })();

    addBenchMarkingListner(function() {
        var trText = "<tr>";
        for(var index in window.benchmarkTableElements) {
            trText += "<td>"+window.benchmarkTableElements[index].manipulate.apply(this, arguments)+"</td>";
        }
        trText += "</tr>";
        document.getElementById('tbl_benchmark').innerHTML += trText;
    });
    
    </script>
</body>

</html>